# PR Reviewer Assignment Service

Тестовый сервис назначения ревьюеров для Pull Request'ов.

## Что делает сервис

- Управляет командами и пользователями.
- Создаёт Pull Request'ы и автоматически назначает до двух ревьюеров из команды автора.
- Позволяет переназначать ревьювера на другого участника его команды.
- Помечает PR как MERGED (идемпотентно).
- Возвращает список PR'ов, где пользователь назначен ревьювером.

Полное описание контрактов лежит в `openapi.yaml`.

---

## Быстрый старт (Docker + docker-compose)

### 1. Подготовить окружение

Установите:

- Docker
- Docker Compose

Скопируйте пример конфига:

```bash
cp .env.example .env
```

Отредактируйте значения в `.env`:

- `DB_USER`, `DB_PASSWORD`, `DB_NAME` — данные для PostgreSQL
- `DB_PORT` — порт PostgreSQL на вашей машине (по умолчанию 5432)
- `DB_SSL_MODE` — режим ssl для подключения (по умолчанию `disable`)
- `SERVER_PORT` — порт HTTP‑сервера (по умолчанию 8080)

### 2. Запуск сервиса

```bash
make up   # (docker compose up -d)
```

Будет запущено три сервиса:

- `db` — PostgreSQL
- `migrate` — применяет SQL‑миграции из каталога `migrations`
- `app` — HTTP‑сервис

После успешного поднятия сервис будет доступен по адресу:

- `http://localhost:8080`

### 3. Остановка

```bash
make down   # (docker compose down)
```

---

## Локальный запуск без Docker

1. Поднимите PostgreSQL и задайте нужные переменные окружения через `.env`.
2. Примените миграции (нужна утилита `migrate`):

   ```bash
   make migrate-up
   ```

3. Запустите сервис:

   ```bash
   make run
   ```

По умолчанию сервер слушает порт из переменной `SERVER_PORT` (8080).

---

## Основные эндпоинты

- `POST /team/add` — создать команду с участниками.
- `GET /team/get?team_name=...` — получить команду.
- `POST /users/setIsActive` — включить/выключить пользователя.
- `POST /pullRequest/create` — создать PR и назначить до двух ревьюверов.
- `POST /pullRequest/merge` — пометить PR как MERGED (идемпотентно).
- `POST /pullRequest/reassign` — переназначить ревьювера на другого участника его команды.
- `GET /users/getReview?user_id=...` — получить PR'ы, где пользователь назначен ревьювером.

Детали форматов запросов и ответов в `openapi.yaml`.
